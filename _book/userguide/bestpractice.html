
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>最佳实践 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="lib.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../HOME.html">
            
                <a href="../HOME.html">
            
                    
                    主页
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    配置
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../setup/gettingstarted.html">
            
                <a href="../setup/gettingstarted.html">
            
                    
                    开始
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../setup/firsttest.html">
            
                <a href="../setup/firsttest.html">
            
                    
                    编写你的第一个测试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    用户指南
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="config.html">
            
                <a href="config.html">
            
                    
                    配置Robolectric
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="qr.html">
            
                <a href="qr.html">
            
                    
                    使用资源限定符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="lifecycle.html">
            
                <a href="lifecycle.html">
            
                    
                    驱动活动生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="addon.html">
            
                <a href="addon.html">
            
                    
                    使用附加包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="lib.html">
            
                <a href="lib.html">
            
                    
                    使用库资源
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.6" data-path="bestpractice.html">
            
                <a href="bestpractice.html">
            
                    
                    最佳实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    定制
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../customize/extend.html">
            
                <a href="../customize/extend.html">
            
                    
                    扩展Robolectric
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../customize/shadows.html">
            
                <a href="../customize/shadows.html">
            
                    
                    创建自定义shadows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../customize/testrunner.html">
            
                <a href="../customize/testrunner.html">
            
                    
                    自定义Test Runner
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    贡献
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../contribute/guide.html">
            
                <a href="../contribute/guide.html">
            
                    
                    贡献指南
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    资源
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" >
            
                <a target="_blank" href="https://github.com/robolectric/robolectric/">
            
                    
                    GitHub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" >
            
                <a target="_blank" href="https://github.com/robolectric/robolectric/releases/">
            
                    
                    发布信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" >
            
                <a target="_blank" href="http://robolectric.org/javadoc/latest/">
            
                    
                    Java文档
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" >
            
                <a target="_blank" href="https://github.com/robolectric/robolectric/issues/">
            
                    
                    问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../">
            
                <a href="../">
            
                    
                    关于我
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >最佳实践</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x6700;&#x4F73;&#x5B9E;&#x8DF5;">&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</h2>
<p>DON&#x2019;T mock or spy on Android classes that will be acted on by other Android code (e.g. Context, SharedPreferences, and many others). Stubbing is very brittle and can lead to breakages on Robolectric or Android Platform upgrades. The small exceptions to this rule are classes with very narrow responsibilities, such as event listeners.</p>
<p>DO test layout inflation in your Robolectric test and ensure that click listeners are set up correctly by testing the Activity and Layout interaction directly rather than mocking the LayoutInflater or providing an abstraction over the view.</p>
<p>&#x5728; Robolectric &#x6D4B;&#x8BD5;&#x4E2D;&#x505A;&#x5E03;&#x5C40;&#x5F15;&#x5165;&#x6D4B;&#x8BD5;&#x65F6;, &#x786E;&#x4FDD;&#x70B9;&#x51FB;&#x76D1;&#x542C;&#x88AB;&#x6B63;&#x786E;&#x7684;&#x8BBE;&#x7F6E;. &#x901A;&#x8FC7;&#x6D4B;&#x8BD5; <code>Acticity</code> &#x548C; <code>Layout</code> &#x76F4;&#x63A5;&#x4EA4;&#x4E92;&#x800C;&#x4E0D;&#x662F;&#x6A21;&#x62DF; <code>LayoutInflater</code> &#x6216;&#x8005;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x89C6;&#x56FE;.</p>
<p>DO use public lifecycle APIs (e.g: via Robolectric.buildActivity()) rather than exposing @VisibleForTesting methods when testing Android components such as Activities and Services. Calling those methods directly makes it difficult to refactor the code under test later.</p>
<p>&#x5F53;&#x6D4B;&#x8BD5;&#x50CF; <code>Activities</code> &#x548C; <code>Services</code> &#x8FD9;&#x6837;&#x7684; Android &#x7EC4;&#x4EF6;&#x65F6;, &#x4F7F;&#x7528;&#x516C;&#x5F00;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F; API (&#x50CF;: <code>Robolectric.buildActivity()</code>) &#x800C;&#x4E0D;&#x662F;&#x66B4;&#x9732; <code>@VisibleForTesting</code> &#x65B9;&#x6CD5;. &#x76F4;&#x63A5;&#x8C03;&#x7528;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801; &#x4F1A;&#x4F7F;&#x5F97;&#x6D4B;&#x8BD5;&#x4E4B;&#x540E;&#x7684;&#x91CD;&#x6784;&#x53D8;&#x5F97;&#x9EBB;&#x70E6;.</p>
<p>DO limit the number of the threads that are running during each test. Rogue threads often cause test pollution because they are not automatically cleaned up between tests. Oftentimes threads are inadvertently spawned when using third-party libraries (e.g for networking) or background processing components. One of the main sources of additional threads during tests are ExecutorServices that maintain thread pools. If possible, mock dependent components that spawn threads, or use a DirectExecutor. If it&#x2019;s necessary to run multiple threads during a test, make sure to explicitly stop all threads and ExecutorServices to avoid test pollution.</p>
<p>&#x5728;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x65F6;&#x9650;&#x5236;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x91CF;. &#x6D41;&#x6C13;&#x7EBF;&#x7A0B;&#x901A;&#x5E38;&#x4F1A;&#x5BFC;&#x81F4;&#x6D4B;&#x8BD5;&#x6C61;&#x67D3;, &#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x4E0D;&#x4F1A;&#x5728;&#x6D4B;&#x8BD5;&#x4E4B;&#x95F4;&#x81EA;&#x52A8;&#x6E05;&#x9664;. &#x5F53;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;(&#x50CF;: &#x7F51;&#x7EDC;)&#x6216;&#x540E;&#x53F0;&#x5904;&#x7406;&#x7EC4;&#x4EF6;&#x65F6;, &#x901A;&#x5E38;&#x4F1A;&#x5F00;&#x542F;&#x65B0;&#x7EBF;&#x7A0B;. &#x6D4B;&#x8BD5;&#x671F;&#x95F4;&#x7684;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x7684;&#x4E3B;&#x8981;&#x6765;&#x6E90;&#x4E4B;&#x4E00;&#x662F; <code>ExecutorService</code> &#x7EBF;&#x7A0B;&#x6C60;&#x7EF4;&#x62A4;. &#x5982;&#x679C;&#x53EF;&#x80FD;, &#x6A21;&#x62DF;&#x4EA7;&#x751F;&#x65B0;&#x7EBF;&#x7A0B;&#x7684;&#x76F8;&#x5173;&#x7EC4;&#x4EF6;&#x6216;&#x4F7F;&#x7528; <code>DirectExecutor</code>. &#x5982;&#x679C;&#x5728;&#x6D4B;&#x8BD5;&#x4E0B;&#x8981;&#x8DD1;&#x591A;&#x7EBF;&#x7A0B;, &#x786E;&#x4FDD;&#x660E;&#x786E;&#x5730;&#x505C;&#x6B62;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x548C; <code>ExecutorService</code> &#x4EE5;&#x907F;&#x514D;&#x6D4B;&#x8BD5;&#x6C61;&#x67D3;. </p>
<p>&#x6CE8;&#x610F;: &#x7531;&#x4E8E;&#x6C34;&#x5E73;&#x6709;&#x9650;, &#x8FD9;&#x91CC;&#x7FFB;&#x8BD1;&#x4E0D;&#x662F;&#x5F88;&#x597D;, &#x8D34;&#x51FA;&#x539F;&#x6587;&#x4EE5;&#x4F9B;&#x53C2;&#x8003;.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="lib.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 使用库资源">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"最佳实践","level":"1.3.6","depth":2,"next":{"title":"定制","level":"1.4","depth":1,"ref":"","articles":[{"title":"扩展Robolectric","level":"1.4.1","depth":2,"path":"customize/extend.md","ref":"customize/extend.md","articles":[]},{"title":"创建自定义shadows","level":"1.4.2","depth":2,"path":"customize/shadows.md","ref":"customize/shadows.md","articles":[]},{"title":"自定义Test Runner","level":"1.4.3","depth":2,"path":"customize/testrunner.md","ref":"customize/testrunner.md","articles":[]}]},"previous":{"title":"使用库资源","level":"1.3.5","depth":2,"path":"userguide/lib.md","ref":"userguide/lib.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"userguide/bestpractice.md","mtime":"2017-07-30T08:18:48.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-07-31T02:59:18.798Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

